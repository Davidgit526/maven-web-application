pipeline {
    agent any
    
    tools {
        maven 'maven3'
    }
    
    environment {
        SCANNER_HOME = tool 'sonar-scanner'
    }
    
        triggers {
        githubPush()
    }


    stages {
        stage('git checkout') {
            steps {
                  git branch: 'main', url: 'https://github.com/Davidgit526/maven-web-application.git'

            }
        }
        
        stage ('soanrqube analysis') {
            steps {
                withSonarQubeEnv('sonar') {
                   sh ''' $SCANNER_HOME/bin/sonar-scanner -Dsonar.projectKey=code-quality-project -Dsonar.projectName=code-quality-project '''
                 }
            }
        }
    }
        
        post {
            success {
                emailext(
                    subject: "SUCCESS: SonarQube quality gate passed",
                    body:"""
                    Hi team,
                    
                    The sonarqube quality gate passed successfully.
                    you can view the report here:
                    http://18.229.137.106:9000/
                    username: admin, passwd: pass
                    
                    Regards,
                    Team DevOps,
                    clahan Technologies pvt ltd.
                    """,
                    to: 'muraliclahan526@gmail.com'
                    )
            }
            failure{
                emailext(
                    subject: 'Failed: sonarqube quality gate',
                    body:"""
                    
                    Hi Team
                    
                    The sonarqube quality gate has failed.
                    
                    Please check the below details
                    
                    http://18.229.137.106:9000/
                    username: admin, passwd: pass
                    
                    Regards,
                    Team DevOps
                    """,
                    to: 'muraliclahan526@gmail.com'
                    )
            }
        }
    
}